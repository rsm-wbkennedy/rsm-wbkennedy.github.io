<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.506">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Warren Kennedy">
<meta name="dcterms.date" content="2024-05-18">

<title>Warren’s Website - Forecasting Demand: An Analysis of Different Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Warren’s Website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.html"> 
<span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">Methodology</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a>
  <ul class="collapse">
  <li><a href="#including-plots" id="toc-including-plots" class="nav-link" data-scroll-target="#including-plots">Including Plots</a></li>
  <li><a href="#question-1" id="toc-question-1" class="nav-link" data-scroll-target="#question-1">Question 1:</a></li>
  <li><a href="#question-2" id="toc-question-2" class="nav-link" data-scroll-target="#question-2">Question 2:</a></li>
  <li><a href="#question-3" id="toc-question-3" class="nav-link" data-scroll-target="#question-3">Question 3:</a></li>
  <li><a href="#question-4" id="toc-question-4" class="nav-link" data-scroll-target="#question-4">Question 4:</a></li>
  <li><a href="#question-5" id="toc-question-5" class="nav-link" data-scroll-target="#question-5">Question 5</a></li>
  <li><a href="#question-6" id="toc-question-6" class="nav-link" data-scroll-target="#question-6">Question 6:</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Forecasting Demand: An Analysis of Different Methods</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Warren Kennedy </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 18, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In this report, we present an analysis of various forecasting methods applied to a dataset containing the demand for eggs from Week 1 to Week 500. We compared four forecasting techniques: Oracle (theoretical maximum profit), Simple Exponential Smoothing (Simple ES), Holt’s Linear Trend Method (Holt), and a tuned version of Holt’s method (Holt tuned). Our goal was to determine which method provides the best forecast accuracy and profitability.</p>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology">Methodology</h2>
<p>The Oracle method represents the theoretical maximum possible profit, assuming perfect knowledge of future demand. It serves as a benchmark for comparing other forecasting methods. The profit calculation for the Oracle method uses the actual demand directly, thus providing the upper bound for potential profitability.</p>
<p>Simple Exponential Smoothing (Simple ES) is a basic forecasting method that uses a smoothing parameter (alpha) to weight the most recent observations. We initially set alpha to 0.2 and calculated forecasts for the dataset. This method helps to smooth out short-term fluctuations and highlight longer-term trends or cycles. Additionally, we calculated the profit using a safety stock based on the forecast errors, ensuring that inventory levels could meet unexpected demand spikes.</p>
<p>Holt’s Linear Trend Method (Holt) extends Simple ES by incorporating a trend component, making it suitable for data with a trend. Initially, we used default values for the smoothing parameters (alpha = 0.2, beta = 0.2). This method accounts for both the level of the series and the trend, thus providing a more nuanced forecast than Simple ES. We calculated the forecasts and profits in a manner similar to Simple ES, but with the added benefit of trend adjustment.</p>
<p>To improve the forecast accuracy of Holt’s method, we optimized the smoothing parameters (alpha and beta) using a grid search approach to minimize the Mean Squared Error (MSE). By tuning these parameters, we aimed to enhance the method’s responsiveness to changes in the data and reduce forecast errors. Using these optimized parameters, we recalculated the forecasts and profits, labeling this version as Holt tuned.</p>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>We compared the average weekly profit from Week 301 to Week 500 for each method. The Oracle method, as expected, provided the highest possible profit since it is based on perfect foresight. Simple ES initially performed well, offering better forecasts than Holt’s default settings due to its simplicity and effectiveness in smoothing random variations in the data. However, when we tuned the parameters of Holt’s method, it showed a significant improvement in forecast accuracy and profitability, ultimately outperforming Simple ES.</p>
<p>Holt’s default settings initially did not provide as high a profit as Simple ES, but after parameter optimization, Holt tuned demonstrated superior performance. This highlights the importance of fine-tuning forecasting models to better capture the underlying patterns in the data.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The analysis demonstrated that while Simple Exponential Smoothing performed well initially, tuning the parameters of Holt’s Linear Trend Method resulted in superior forecasts and higher profitability. This underscores the importance of parameter optimization in forecasting models to achieve the best possible performance.</p>
<p>By leveraging these findings, organizations can enhance their demand forecasting accuracy and optimize inventory management, leading to improved financial outcomes. Accurate forecasts help in maintaining optimal inventory levels, reducing holding costs, and minimizing stockouts, thereby contributing to overall operational efficiency and customer satisfaction. This study illustrates the practical benefits of applying sophisticated forecasting techniques and the value of continuous improvement through model tuning.</p>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/MGTA456/Homework/Homework2/forecasting_demand_data_2024.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add time trend</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">t=</span><span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># descriptives</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       t             demand    
 Min.   :  1.0   Min.   :1606  
 1st Qu.:125.8   1st Qu.:2477  
 Median :250.5   Median :3045  
 Mean   :250.5   Mean   :3012  
 3rd Qu.:375.2   3rd Qu.:3528  
 Max.   :500.0   Max.   :4410  </code></pre>
</div>
</div>
<section id="including-plots" class="level3">
<h3 class="anchored" data-anchor-id="including-plots">Including Plots</h3>
<p>The data is not normally distributed.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1_questions_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The demand has shows an upward trend across time. This tells us that a forecast would be best approximated using a moving average based on an appropriate window of time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> t, <span class="at">y=</span> demand)) <span class="sc">+</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1_questions_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="question-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1">Question 1:</h2>
<p>Use the data from Week1 to Week300 to estimate the slope “a” in time (t) and the intercept “b” from the linear regression model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the relevant columns and rows</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> df[<span class="dv">1</span><span class="sc">:</span><span class="dv">300</span>,]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform linear regression</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(demand <span class="sc">~</span> t, <span class="at">data =</span> train)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the slope (a) and intercept (b)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)[<span class="st">"t"</span>]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)[<span class="st">"(Intercept)"</span>]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Slope (a):"</span>, a, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Slope (a): 4.519219 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Intercept (b):"</span>, b, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept (b): 1919.371 </code></pre>
</div>
</div>
</section>
<section id="question-2" class="level2">
<h2 class="anchored" data-anchor-id="question-2">Question 2:</h2>
<p>Use L0=b and T0=a from the above linear regression. Use alpha=0.2 and beta=0.2. Estimate the forecast from Week1 to Week 500.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize parameters</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>L0 <span class="ot">&lt;-</span> b</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>T0 <span class="ot">&lt;-</span> a</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize level, trend, and forecast</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>Lt <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>Tt <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>Ft <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Holt-Winters forecasting</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>) {</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    Lt[i] <span class="ot">&lt;-</span> alpha <span class="sc">*</span> df<span class="sc">$</span>demand[i] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> (L0 <span class="sc">+</span> T0)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    Tt[i] <span class="ot">&lt;-</span> beta <span class="sc">*</span> (Lt[i] <span class="sc">-</span> L0) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> beta) <span class="sc">*</span> T0</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    Ft[i] <span class="ot">&lt;-</span> L0 <span class="sc">+</span> T0</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">&lt;=</span> <span class="fu">nrow</span>(df)) {</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    Lt[i] <span class="ot">&lt;-</span> alpha <span class="sc">*</span> df<span class="sc">$</span>demand[i] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> (Lt[i<span class="dv">-1</span>] <span class="sc">+</span> Tt[i<span class="dv">-1</span>])</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    Tt[i] <span class="ot">&lt;-</span> beta <span class="sc">*</span> (Lt[i] <span class="sc">-</span> Lt[i<span class="dv">-1</span>]) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> beta) <span class="sc">*</span> Tt[i<span class="dv">-1</span>]</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    Ft[i] <span class="ot">&lt;-</span> Lt[i<span class="dv">-1</span>] <span class="sc">+</span> Tt[i<span class="dv">-1</span>]</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    Lt[i] <span class="ot">&lt;-</span> Lt[i<span class="dv">-1</span>] <span class="sc">+</span> Tt[i<span class="dv">-1</span>]</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    Tt[i] <span class="ot">&lt;-</span> Tt[i<span class="dv">-1</span>]</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    Ft[i] <span class="ot">&lt;-</span> Lt[i<span class="dv">-1</span>] <span class="sc">+</span> Tt[i<span class="dv">-1</span>]</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame to store the results</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Week =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>, <span class="at">Forecast =</span> Ft[<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>])</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the forecast data</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(forecast_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Week Forecast
1      1 1923.890
2      2 1940.436
3      3 1941.815
4      4 1896.885
5      5 1839.186
6      6 1840.660
7      7 1957.772
8      8 1884.791
9      9 2022.135
10    10 2077.844
11    11 2214.098
12    12 2167.937
13    13 2242.491
14    14 2135.034
15    15 2121.908
16    16 2151.490
17    17 2090.096
18    18 1996.618
19    19 1966.890
20    20 2081.872
21    21 2091.343
22    22 2015.426
23    23 2078.635
24    24 2050.777
25    25 2049.340
26    26 2100.616
27    27 1990.733
28    28 1938.837
29    29 2027.206
30    30 2113.454
31    31 2229.074
32    32 2344.047
33    33 2321.183
34    34 2253.685
35    35 2127.979
36    36 2050.735
37    37 1957.311
38    38 1964.839
39    39 1893.267
40    40 1956.360
41    41 1870.739
42    42 1907.933
43    43 1949.491
44    44 2026.638
45    45 2058.570
46    46 2153.532
47    47 2187.641
48    48 2290.943
49    49 2289.146
50    50 2232.463
51    51 2182.458
52    52 2211.436
53    53 2292.440
54    54 2293.347
55    55 2193.338
56    56 2079.117
57    57 2013.336
58    58 2007.097
59    59 1949.783
60    60 2048.540
61    61 2067.484
62    62 2147.860
63    63 2091.926
64    64 2056.622
65    65 1992.354
66    66 2145.325
67    67 2273.449
68    68 2415.131
69    69 2531.830
70    70 2459.357
71    71 2491.004
72    72 2440.922
73    73 2340.259
74    74 2252.038
75    75 2244.540
76    76 2143.480
77    77 2036.933
78    78 2031.218
79    79 1956.037
80    80 2030.091
81    81 1977.410
82    82 1916.889
83    83 2005.477
84    84 2078.368
85    85 2081.266
86    86 2222.854
87    87 2226.530
88    88 2256.210
89    89 2282.746
90    90 2317.664
91    91 2422.412
92    92 2404.834
93    93 2428.659
94    94 2479.452
95    95 2492.988
96    96 2518.898
97    97 2608.389
98    98 2691.127
99    99 2648.552
100  100 2571.430
101  101 2430.196
102  102 2336.720
103  103 2216.671
104  104 2314.484
105  105 2358.556
106  106 2312.231
107  107 2316.482
108  108 2306.983
109  109 2382.865
110  110 2412.536
111  111 2501.611
112  112 2605.167
113  113 2667.085
114  114 2755.096
115  115 2689.661
116  116 2671.966
117  117 2614.532
118  118 2613.243
119  119 2544.963
120  120 2492.380
121  121 2405.058
122  122 2293.558
123  123 2329.216
124  124 2228.094
125  125 2363.152
126  126 2282.793
127  127 2211.074
128  128 2171.136
129  129 2128.900
130  130 2204.075
131  131 2381.612
132  132 2382.177
133  133 2436.102
134  134 2548.078
135  135 2598.736
136  136 2671.873
137  137 2579.427
138  138 2520.973
139  139 2610.132
140  140 2644.853
141  141 2669.836
142  142 2777.109
143  143 2857.403
144  144 2766.382
145  145 2681.990
146  146 2609.437
147  147 2551.297
148  148 2511.053
149  149 2452.056
150  150 2552.976
151  151 2578.033
152  152 2642.997
153  153 2657.928
154  154 2600.436
155  155 2646.585
156  156 2763.561
157  157 2729.599
158  158 2823.926
159  159 2747.430
160  160 2634.296
161  161 2609.177
162  162 2492.435
163  163 2504.344
164  164 2632.857
165  165 2634.274
166  166 2609.236
167  167 2601.716
168  168 2555.512
169  169 2567.448
170  170 2669.738
171  171 2665.782
172  172 2702.185
173  173 2779.300
174  174 2852.340
175  175 2762.399
176  176 2839.270
177  177 2890.276
178  178 2990.869
179  179 2914.389
180  180 2968.430
181  181 2829.605
182  182 2800.321
183  183 2662.081
184  184 2666.286
185  185 2716.158
186  186 2756.090
187  187 2673.191
188  188 2733.545
189  189 2843.206
190  190 2829.407
191  191 2705.271
192  192 2692.352
193  193 2756.722
194  194 2833.229
195  195 2866.786
196  196 2750.920
197  197 2658.991
198  198 2773.167
199  199 2837.382
200  200 2933.658
201  201 2919.213
202  202 2840.888
203  203 2915.473
204  204 2816.002
205  205 2913.745
206  206 2977.830
207  207 2926.544
208  208 2864.854
209  209 2886.748
210  210 2837.593
211  211 2905.525
212  212 2780.730
213  213 2727.025
214  214 2622.339
215  215 2725.138
216  216 2663.451
217  217 2587.563
218  218 2714.191
219  219 2775.605
220  220 2869.912
221  221 3008.961
222  222 3132.082
223  223 3035.816
224  224 2954.290
225  225 2924.698
226  226 2831.836
227  227 2719.153
228  228 2741.761
229  229 2671.977
230  230 2729.230
231  231 2807.424
232  232 2856.561
233  233 2908.129
234  234 2888.138
235  235 2808.580
236  236 2766.030
237  237 2809.949
238  238 2951.607
239  239 2986.708
240  240 2983.881
241  241 2953.944
242  242 2863.397
243  243 2770.623
244  244 2864.619
245  245 2881.151
246  246 2996.251
247  247 3123.721
248  248 3166.867
249  249 3223.470
250  250 3301.534
251  251 3185.643
252  252 3238.705
253  253 3155.046
254  254 3211.397
255  255 3123.342
256  256 3200.125
257  257 3184.386
258  258 3045.699
259  259 3103.922
260  260 3180.903
261  261 3164.692
262  262 3050.975
263  263 3048.003
264  264 3084.945
265  265 3142.701
266  266 3201.798
267  267 3219.363
268  268 3144.881
269  269 3136.940
270  270 3029.709
271  271 3140.777
272  272 3216.360
273  273 3293.371
274  274 3206.966
275  275 3134.683
276  276 3210.109
277  277 3295.246
278  278 3206.386
279  279 3143.242
280  280 3201.037
281  281 3264.232
282  282 3333.938
283  283 3362.386
284  284 3327.009
285  285 3352.547
286  286 3247.275
287  287 3244.607
288  288 3120.288
289  289 3197.821
290  290 3106.455
291  291 3094.304
292  292 3167.971
293  293 3196.586
294  294 3256.694
295  295 3243.553
296  296 3237.698
297  297 3273.826
298  298 3355.695
299  299 3452.203
300  300 3337.321
301  301 3420.243
302  302 3277.090
303  303 3192.405
304  304 3282.880
305  305 3355.225
306  306 3310.052
307  307 3323.152
308  308 3345.985
309  309 3393.853
310  310 3344.873
311  311 3222.534
312  312 3263.161
313  313 3174.377
314  314 3285.894
315  315 3360.152
316  316 3329.952
317  317 3407.795
318  318 3377.437
319  319 3445.933
320  320 3349.132
321  321 3291.687
322  322 3252.343
323  323 3185.774
324  324 3194.648
325  325 3200.481
326  326 3175.248
327  327 3309.452
328  328 3200.757
329  329 3279.691
330  330 3247.531
331  331 3276.501
332  332 3228.497
333  333 3198.554
334  334 3216.778
335  335 3158.165
336  336 3100.069
337  337 3208.589
338  338 3334.261
339  339 3260.789
340  340 3379.219
341  341 3499.315
342  342 3448.139
343  343 3563.432
344  344 3495.690
345  345 3373.668
346  346 3436.904
347  347 3413.257
348  348 3466.169
349  349 3572.212
350  350 3632.997
351  351 3528.266
352  352 3597.790
353  353 3546.058
354  354 3489.030
355  355 3364.046
356  356 3276.778
357  357 3299.131
358  358 3233.809
359  359 3267.359
360  360 3308.945
361  361 3258.015
362  362 3238.911
363  363 3183.232
364  364 3148.439
365  365 3309.507
366  366 3450.301
367  367 3473.524
368  368 3562.122
369  369 3646.875
370  370 3603.963
371  371 3536.474
372  372 3529.304
373  373 3537.797
374  374 3510.998
375  375 3444.120
376  376 3389.132
377  377 3331.777
378  378 3309.542
379  379 3454.692
380  380 3405.504
381  381 3478.774
382  382 3495.679
383  383 3561.415
384  384 3615.548
385  385 3569.792
386  386 3499.876
387  387 3529.308
388  388 3513.681
389  389 3463.153
390  390 3494.844
391  391 3588.083
392  392 3559.671
393  393 3536.394
394  394 3542.117
395  395 3625.731
396  396 3615.833
397  397 3675.441
398  398 3719.310
399  399 3761.912
400  400 3815.638
401  401 3731.793
402  402 3794.285
403  403 3666.548
404  404 3711.776
405  405 3681.167
406  406 3545.554
407  407 3556.241
408  408 3594.141
409  409 3505.815
410  410 3485.442
411  411 3532.646
412  412 3549.783
413  413 3635.061
414  414 3610.882
415  415 3622.903
416  416 3598.843
417  417 3531.522
418  418 3541.804
419  419 3649.158
420  420 3783.474
421  421 3733.189
422  422 3716.033
423  423 3680.506
424  424 3765.265
425  425 3663.062
426  426 3731.696
427  427 3750.776
428  428 3710.209
429  429 3796.987
430  430 3746.410
431  431 3774.292
432  432 3674.906
433  433 3714.480
434  434 3726.241
435  435 3693.360
436  436 3808.601
437  437 3889.969
438  438 3959.425
439  439 3989.853
440  440 3949.081
441  441 4026.981
442  442 4092.341
443  443 3988.255
444  444 3897.537
445  445 3962.780
446  446 3950.064
447  447 3898.208
448  448 3754.236
449  449 3836.288
450  450 3764.678
451  451 3841.363
452  452 3769.657
453  453 3694.786
454  454 3686.297
455  455 3749.374
456  456 3740.541
457  457 3804.533
458  458 3840.985
459  459 3882.067
460  460 3946.211
461  461 3941.317
462  462 3993.469
463  463 4010.452
464  464 4108.620
465  465 4029.250
466  466 4015.104
467  467 3932.103
468  468 3944.298
469  469 4039.882
470  470 4118.914
471  471 4142.223
472  472 4160.581
473  473 4005.445
474  474 3981.078
475  475 4065.821
476  476 4077.463
477  477 4105.638
478  478 4152.592
479  479 4089.412
480  480 4152.131
481  481 4192.142
482  482 4262.264
483  483 4249.392
484  484 4130.558
485  485 4028.389
486  486 4069.358
487  487 4006.919
488  488 4031.771
489  489 4101.061
490  490 4080.252
491  491 4015.474
492  492 4088.432
493  493 3963.662
494  494 3997.699
495  495 3970.981
496  496 4060.007
497  497 4128.588
498  498 4122.829
499  499 4012.549
500  500 3892.622</code></pre>
</div>
</div>
</section>
<section id="question-3" class="level2">
<h2 class="anchored" data-anchor-id="question-3">Question 3:</h2>
<p>What is the stocking quantity at Week 301?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set exogenous values as constants</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>cost <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>salvage <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>SL <span class="ot">&lt;-</span> (price<span class="sc">-</span>cost)<span class="sc">/</span>(price<span class="sc">-</span>salvage)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the forecast to the dataframe</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">forecast_Holt =</span> Ft[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)],</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">forecast_error_Holt =</span> demand <span class="sc">-</span> forecast_Holt)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate safety stock and stocking quantity for Week 301</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>safety_stock <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantile</span>(df<span class="sc">$</span>forecast_error_Holt[<span class="dv">1</span><span class="sc">:</span><span class="dv">300</span>], SL, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>stocking_optimal_adaptive <span class="ot">&lt;-</span> Ft[<span class="dv">301</span>] <span class="sc">+</span> safety_stock</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the stocking quantity at Week 301</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"The stocking quantity at Week 301 is: %.2f"</span>, stocking_optimal_adaptive))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The stocking quantity at Week 301 is: 3737.22</code></pre>
</div>
</div>
</section>
<section id="question-4" class="level2">
<h2 class="anchored" data-anchor-id="question-4">Question 4:</h2>
<p>What is the weekly average profit from Week301 to Week500? Do you see an improvement over simple Exponential Smoothing?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set placeholder table</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>profit <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(df), <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(profit) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Oracle"</span>, <span class="st">"Simple ES"</span>, <span class="st">"Holt"</span>, <span class="st">"Holt (tuned)"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(profit) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"day"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(profit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Oracle Simple ES Holt Holt (tuned)
day1     NA        NA   NA           NA
day2     NA        NA   NA           NA
day3     NA        NA   NA           NA
day4     NA        NA   NA           NA
day5     NA        NA   NA           NA
day6     NA        NA   NA           NA</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># oracle</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we are assuming we have actual demand</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">301</span><span class="sc">:</span><span class="fu">nrow</span>(df)) {</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  profit[i, <span class="st">"Oracle"</span>] <span class="ot">&lt;-</span> price<span class="sc">*</span>df<span class="sc">$</span>demand[i]<span class="sc">-</span>cost<span class="sc">*</span>df<span class="sc">$</span>demand[i]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple ES</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>L0 <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>Lt <span class="ot">&lt;-</span> <span class="fu">c</span>(); Ft <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)) {</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    Lt[i] <span class="ot">&lt;-</span> alpha<span class="sc">*</span>df<span class="sc">$</span>demand[i]<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>L0 </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    Ft[i] <span class="ot">&lt;-</span> L0</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    Lt[i] <span class="ot">&lt;-</span> alpha<span class="sc">*</span>df<span class="sc">$</span>demand[i]<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>Lt[i<span class="dv">-1</span>]</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    Ft[i] <span class="ot">&lt;-</span> Lt[i<span class="dv">-1</span>]</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">forecast_Simple_ES=</span>Ft,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">forecast_error_Simple_ES=</span> demand <span class="sc">-</span> forecast_Simple_ES)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># finding safety stock based on TSL</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">301</span><span class="sc">:</span><span class="fu">nrow</span>(df)) {</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  safety_stock <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantile</span>(df<span class="sc">$</span>forecast_error_Simple_ES[<span class="dv">1</span><span class="sc">:</span>(i<span class="dv">-1</span>)],SL,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  stocking_optimal_adaptive<span class="ot">&lt;-</span> df<span class="sc">$</span>forecast_Simple_ES[i] <span class="sc">+</span> safety_stock</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  profit[i,<span class="st">"Simple ES"</span>] <span class="ot">&lt;-</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    price<span class="sc">*</span><span class="fu">min</span>(stocking_optimal_adaptive,df<span class="sc">$</span>demand[i]) <span class="sc">-</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    cost<span class="sc">*</span>stocking_optimal_adaptive</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Holt</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">301</span><span class="sc">:</span><span class="fu">nrow</span>(df)) {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  safety_stock <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantile</span>(df<span class="sc">$</span>forecast_error_Holt[<span class="dv">1</span><span class="sc">:</span>(i<span class="dv">-1</span>)], SL, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  stocking_optimal_adaptive <span class="ot">&lt;-</span> df<span class="sc">$</span>forecast_Holt[i] <span class="sc">+</span> safety_stock</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  profit[i, <span class="st">"Holt"</span>] <span class="ot">&lt;-</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    price <span class="sc">*</span> <span class="fu">min</span>(stocking_optimal_adaptive, df<span class="sc">$</span>demand[i]) <span class="sc">-</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    cost <span class="sc">*</span> stocking_optimal_adaptive</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>average_profit <span class="ot">&lt;-</span> <span class="fu">mean</span>(profit[<span class="dv">301</span><span class="sc">:</span><span class="dv">500</span>, <span class="st">"Holt"</span>], <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the weekly average profit</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"The weekly average profit from Week 301 to Week 500 is: %.2f"</span>, average_profit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The weekly average profit from Week 301 to Week 500 is: 11284.45</code></pre>
</div>
</div>
<p><strong>When we calculate the average profit for a Simple Exponential Smoothing and our Holt model, we observe that the Holt model does not offer an improvement over the Simple ES.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare average profit by forecasting method</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(profit[<span class="dv">301</span><span class="sc">:</span><span class="dv">500</span>, ], <span class="dv">2</span>, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Oracle    Simple ES         Holt Holt (tuned) 
    11620.86     11298.89     11284.45           NA </code></pre>
</div>
</div>
</section>
<section id="question-5" class="level2">
<h2 class="anchored" data-anchor-id="question-5">Question 5</h2>
<p>Use the data from Week1 to Week300 to find an “optimal” alpha and beta values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate MSE for given alpha and beta</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>mse_holt <span class="ot">&lt;-</span> <span class="cf">function</span>(params, predict_from, predict_to, df, L0, T0) {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> params[<span class="dv">1</span>]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> params[<span class="dv">2</span>]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  df_predict <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice</span>(predict_from<span class="sc">:</span>predict_to)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  df_true <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice</span>(predict_from<span class="sc">:</span>predict_to)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  Lt <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  Tt <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  Ft <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> predict_to <span class="sc">-</span> predict_from <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>      Lt[i] <span class="ot">&lt;-</span> alpha <span class="sc">*</span> df_predict<span class="sc">$</span>demand[i] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> (L0 <span class="sc">+</span> T0)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>      Tt[i] <span class="ot">&lt;-</span> beta <span class="sc">*</span> (Lt[i] <span class="sc">-</span> L0) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> beta) <span class="sc">*</span> T0</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>      Ft[i] <span class="ot">&lt;-</span> L0 <span class="sc">+</span> T0</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>      Lt[i] <span class="ot">&lt;-</span> alpha <span class="sc">*</span> df_predict<span class="sc">$</span>demand[i] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> (Lt[i<span class="dv">-1</span>] <span class="sc">+</span> Tt[i<span class="dv">-1</span>])</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>      Tt[i] <span class="ot">&lt;-</span> beta <span class="sc">*</span> (Lt[i] <span class="sc">-</span> Lt[i<span class="dv">-1</span>]) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> beta) <span class="sc">*</span> Tt[i<span class="dv">-1</span>]</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>      Ft[i] <span class="ot">&lt;-</span> Lt[i<span class="dv">-1</span>] <span class="sc">+</span> Tt[i<span class="dv">-1</span>]</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  mse <span class="ot">&lt;-</span> <span class="fu">sum</span>((df_true<span class="sc">$</span>demand <span class="sc">-</span> Ft)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> n</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mse)</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the initial MSE value</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>initial_mse <span class="ot">&lt;-</span> <span class="fu">mse_holt</span>(<span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>), <span class="dv">1</span>, <span class="dv">300</span>, df, L0, T0)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"The initial MSE is: %.2f</span><span class="sc">\n</span><span class="st">"</span>, initial_mse))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The initial MSE is: 111095.64</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimizing alpha and beta using the optim function</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">optim</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">par =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>), </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fn =</span> mse_holt, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">predict_from =</span> <span class="dv">1</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">predict_to =</span> <span class="dv">300</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> df,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">L0 =</span> L0,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">T0 =</span> T0,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.0</span>),</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">1000</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$par
[1] 0.013468860 0.000111058

$value
[1] 88371.42

$counts
function gradient 
      49       49 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract optimal alpha and beta</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  optimal_alpha <span class="ot">&lt;-</span> res<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  optimal_beta <span class="ot">&lt;-</span> res<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print the optimal alpha and beta values</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"The optimal alpha is: %.2f</span><span class="sc">\n</span><span class="st">"</span>, optimal_alpha))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The optimal alpha is: 0.01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"The optimal beta is: %.2f</span><span class="sc">\n</span><span class="st">"</span>, optimal_beta))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The optimal beta is: 0.00</code></pre>
</div>
</div>
</section>
<section id="question-6" class="level2">
<h2 class="anchored" data-anchor-id="question-6">Question 6:</h2>
<p>Use alpha and beta values from Question 5, and repeat Question 4.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize level, trend, and forecast for Holt-Winters with optimal parameters</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>Lt <span class="ot">&lt;-</span> <span class="fu">c</span>(); Tt <span class="ot">&lt;-</span> <span class="fu">c</span>(); Ft <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Holt-Winters forecasting with optimal parameters</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>) {</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    Lt[i] <span class="ot">&lt;-</span> optimal_alpha <span class="sc">*</span> df<span class="sc">$</span>demand[i] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> optimal_alpha) <span class="sc">*</span> (L0 <span class="sc">+</span> T0)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    Tt[i] <span class="ot">&lt;-</span> optimal_beta <span class="sc">*</span> (Lt[i] <span class="sc">-</span> L0) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> optimal_beta) <span class="sc">*</span> T0</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    Ft[i] <span class="ot">&lt;-</span> L0 <span class="sc">+</span> T0</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">&lt;=</span> <span class="fu">nrow</span>(df)) {</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    Lt[i] <span class="ot">&lt;-</span> optimal_alpha <span class="sc">*</span> df<span class="sc">$</span>demand[i] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> optimal_alpha) <span class="sc">*</span> (Lt[i<span class="dv">-1</span>] <span class="sc">+</span> Tt[i<span class="dv">-1</span>])</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    Tt[i] <span class="ot">&lt;-</span> optimal_beta <span class="sc">*</span> (Lt[i] <span class="sc">-</span> Lt[i<span class="dv">-1</span>]) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> optimal_beta) <span class="sc">*</span> Tt[i<span class="dv">-1</span>]</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    Ft[i] <span class="ot">&lt;-</span> Lt[i<span class="dv">-1</span>] <span class="sc">+</span> Tt[i<span class="dv">-1</span>]</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    Lt[i] <span class="ot">&lt;-</span> Lt[i<span class="dv">-1</span>] <span class="sc">+</span> Tt[i<span class="dv">-1</span>]</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    Tt[i] <span class="ot">&lt;-</span> Tt[i<span class="dv">-1</span>]</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    Ft[i] <span class="ot">&lt;-</span> Lt[i<span class="dv">-1</span>] <span class="sc">+</span> Tt[i<span class="dv">-1</span>]</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the forecast to the dataframe</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">forecast_Holt_tuned =</span> Ft[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)],</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">forecast_error_Holt_tuned =</span> demand <span class="sc">-</span> forecast_Holt_tuned)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Holt-Winters profit with optimal parameters</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">301</span><span class="sc">:</span><span class="fu">nrow</span>(df)) {</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  safety_stock <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantile</span>(df<span class="sc">$</span>forecast_error_Holt_tuned[<span class="dv">1</span><span class="sc">:</span>(i<span class="dv">-1</span>)], SL, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  stocking_optimal_adaptive <span class="ot">&lt;-</span> df<span class="sc">$</span>forecast_Holt_tuned[i] <span class="sc">+</span> safety_stock</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  profit[i, <span class="st">"Holt (tuned)"</span>] <span class="ot">&lt;-</span> price <span class="sc">*</span> <span class="fu">min</span>(stocking_optimal_adaptive, df<span class="sc">$</span>demand[i]) <span class="sc">-</span> cost <span class="sc">*</span> stocking_optimal_adaptive</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare average profit by forecasting method</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>average_profits <span class="ot">&lt;-</span> <span class="fu">apply</span>(profit[<span class="dv">301</span><span class="sc">:</span><span class="dv">500</span>, ], <span class="dv">2</span>, mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(average_profits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Oracle    Simple ES         Holt Holt (tuned) 
    11620.86     11298.89     11284.45     11315.78 </code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>